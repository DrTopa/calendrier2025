<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŽ¤ Eurovision Junior 2025 â€“ Jour 12</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: #fdf6e3;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      font-size: 2em;
      text-align: center;
      color: #b71c1c;
      margin-bottom: 10px;
      font-family: 'Comic Sans MS', cursive;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }

    #instructions {
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      max-width: 600px;
      margin-bottom: 20px;
      font-size: 1.05em;
      text-align: center;
    }

    #pointsInfo {
      font-size: 0.9em;
      color: #555;
      margin-top: 5px;
    }

    #predictionArea {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 20px;
      max-width: 600px;
      width: 100%;
    }

    .match-card {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 6px 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s;
    }

    .match-card:hover {
      transform: translateY(-3px);
    }

    .match-title {
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    }

    input[type="text"], input[type="number"] {
      padding: 8px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 90%;
      margin-bottom: 8px;
      text-align: center;
    }

    #submit-btn {
      padding: 10px 20px;
      font-size: 1.1em;
      cursor: pointer;
      background-color: #388e3c;
      color: white;
      border: none;
      border-radius: 6px;
      margin-top: 20px;
    }

    #submit-btn:hover { background-color: #2e7d32; }

    #your-answer {
      margin-top: 15px;
      font-weight: bold;
      font-size: 1.05em;
      color: #2e7d32;
    }

    #answersList {
      display: none;
      margin-top: 25px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 4px 6px rgba(0,0,0,0.12);
      max-width: 600px;
      width: 100%;
    }

    #answersList ul { padding-left: 0; margin: 0; }
    #answersList li {
      background: rgba(250,250,250,0.9);
      margin: 8px 0;
      padding: 8px;
      border-radius: 6px;
      border-left: 5px solid #b71c1c;
      list-style: none;
      font-size: 0.95em;
    }
  </style>
</head>
<body>

<h1>ðŸŽ¤ Eurovision Junior 2025 â€“ Jour 12</h1>

<div id="instructions">
  <p>Faites vos pronostics pour lâ€™Eurovision Junior 2025 :</p>
  <ul style="text-align:left; display:inline-block;">
    <li>Quel pays sera premier ?</li>
    <li>Quels pays seront dans le Top 3 ?</li>
    <li>Classement de la France (1 Ã  18)</li>
    <li>Classement de lâ€™ArmÃ©nie (1 Ã  18)</li>
    <li>Quel pays sera dernier ?</li>
  </ul>
  <div id="pointsInfo">
    Points : <br>
    âœ… Premier et dernier correct = 30 pts chacun<br>
    âœ… Top 3 correct = 15 pts par pays prÃ©sent dans le Top 3<br>
    âœ… France et ArmÃ©nie corrects = 50 pts (-10 pts par diffÃ©rence)
  </div>
</div>

<div id="predictionArea">

  <div class="match-card">
    <div class="match-title">Pays premier</div>
    <input type="text" id="firstCountry" placeholder="Ex: Espagne">
  </div>

  <div class="match-card">
    <div class="match-title">Top 3</div>
    <input type="text" id="top3Countries" placeholder="SÃ©parez les pays par des virgules">
  </div>

  <div class="match-card">
    <div class="match-title">Classement de la France</div>
    <input type="number" id="franceRank" min="1" max="18" placeholder="1 Ã  18">
  </div>

  <div class="match-card">
    <div class="match-title">Classement de lâ€™ArmÃ©nie</div>
    <input type="number" id="armeniaRank" min="1" max="18" placeholder="1 Ã  18">
  </div>

  <div class="match-card">
    <div class="match-title">Pays dernier</div>
    <input type="text" id="lastCountry" placeholder="Ex: Portugal">
  </div>

  <button id="submit-btn">Soumettre mes paris</button>
  <div id="your-answer"></div>

  <div id="answersList">
    <h3>ðŸ“Š Pronostics des autres joueurs :</h3>
    <ul id="answers"></ul>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDlMXjm5ibq9FiPOjrBD1HFAIlYRnCzqA",
  authDomain: "calendrier2025-3185f.firebaseapp.com",
  projectId: "calendrier2025-3185f",
  storageBucket: "calendrier2025-3185f.firebasestorage.app",
  messagingSenderId: "846792576145",
  appId: "1:846792576145:web:59028ccef4ffd5c8010330",
  measurementId: "G-L62L4JSYMF"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const submitBtn = document.getElementById("submit-btn");
const yourAnswerDiv = document.getElementById("your-answer");
const answersListDiv = document.getElementById("answersList");
const answersUl = document.getElementById("answers");
let currentUser = null;

onAuthStateChanged(auth, async (user) => {
  if(!user) { window.location.href = "login.html"; return; }
  currentUser = user;

  const jour12Ref = doc(db, "Predictions", "Jour 12");
  const jour12Snap = await getDoc(jour12Ref);
  if(jour12Snap.exists() && jour12Snap.data()[user.uid]) {
    showExistingPrediction(jour12Snap.data()[user.uid]);
  } 
});

function showExistingPrediction(data) {
  document.querySelectorAll("input").forEach(i=>i.disabled=true);
  submitBtn.style.display = "none";

  yourAnswerDiv.innerHTML = "âœ… Vos pronostics :<ul style='padding-left:0'>";
  yourAnswerDiv.innerHTML += `<li>Pays premier : ${data.firstCountry}</li>`;
  yourAnswerDiv.innerHTML += `<li>Top 3 : ${data.top3Countries}</li>`;
  yourAnswerDiv.innerHTML += `<li>France : ${data.franceRank}</li>`;
  yourAnswerDiv.innerHTML += `<li>ArmÃ©nie : ${data.armeniaRank}</li>`;
  yourAnswerDiv.innerHTML += `<li>Pays dernier : ${data.lastCountry}</li>`;
  yourAnswerDiv.innerHTML += "</ul>";

  answersListDiv.style.display = "block";
  loadOtherAnswers();
}

submitBtn.addEventListener("click", async ()=>{
  if(!currentUser) { alert("Utilisateur non identifiÃ©"); return; }

  const payload = {
    userId: currentUser.uid,
    userEmail: currentUser.email,
    firstCountry: document.getElementById("firstCountry").value.trim(),
    top3Countries: document.getElementById("top3Countries").value.trim(),
    franceRank: Number(document.getElementById("franceRank").value),
    armeniaRank: Number(document.getElementById("armeniaRank").value),
    lastCountry: document.getElementById("lastCountry").value.trim(),
    timestamp: new Date().toISOString()
  };

  const jour12Ref = doc(db, "Predictions", "Jour 12");
  const jour12Snap = await getDoc(jour12Ref);

  if(jour12Snap.exists()){
    if(jour12Snap.data()[currentUser.uid]){
      alert("Vous avez dÃ©jÃ  soumis vos pronostics pour Jour 12.");
      showExistingPrediction(jour12Snap.data()[currentUser.uid]);
      return;
    }
    await updateDoc(jour12Ref, { [currentUser.uid]: payload });
  } else {
    await setDoc(jour12Ref, { [currentUser.uid]: payload });
  }

  showExistingPrediction(payload);
});

async function loadOtherAnswers(){
  answersUl.innerHTML = "";
  const jour12Ref = doc(db, "Predictions", "Jour 12");
  const jour12Snap = await getDoc(jour12Ref);
  if(!jour12Snap.exists()) return;
  const all = jour12Snap.data();
  Object.entries(all).forEach(([uid,data])=>{
    if(uid === currentUser.uid) return;
    const li = document.createElement("li");
    li.innerHTML = `<b>${data.userEmail||'Anonyme'}</b> : Premier: ${data.firstCountry} | Top3: ${data.top3Countries} | France: ${data.franceRank} | ArmÃ©nie: ${data.armeniaRank} | Dernier: ${data.lastCountry}`;
    answersUl.appendChild(li);
  });
  answersListDiv.style.display = "block";
}
</script>

</body>
</html>
