<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ Paris ‚Äì Handball ‚Ä¢ Biathlon ‚Ä¢ Metroid üéØ</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background-color: #ffebcd;
      background-image: url('https://www.transparenttextures.com/patterns/snow.png');
      margin: 0;
      padding: 20px;
    }

    h1 {
      font-size: 2.3em;
      margin-bottom: 10px;
      color: #b71c1c;
      font-family: 'Comic Sans MS', cursive;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }

    #userStatus {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.1em;
      color: #a23636;
    }

    #instructions {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      margin-bottom: 20px;
      text-align: center;
      max-width: 900px;
      font-size: 1.1em;
      color: #333;
    }

    #predictionArea {
      background: rgba(255, 255, 255, 0.85);
      border: 2px solid #b71c1c;
      border-radius: 12px;
      padding: 20px 30px;
      box-shadow: 0 8px 12px rgba(0,0,0,0.2);
      text-align: center;
      width: 100%;
      max-width: 650px;
    }

    select, input {
      padding: 10px;
      font-size: 1.1em;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 80%;
    }

    #submit-btn {
      padding: 10px 20px;
      font-size: 1.1em;
      cursor: pointer;
      background-color: #388e3c;
      color: white;
      border: none;
      border-radius: 5px;
      margin-top: 10px;
    }

    #submit-btn:hover {
      background-color: #2e7d32;
    }

    #answersList {
      display: none;
      margin-top: 25px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      max-width: 600px;
      width: 90%;
    }

    #answersList li {
      background: rgba(255,255,255,0.6);
      margin: 6px 0;
      padding: 6px 10px;
      border-radius: 6px;
      border-left: 5px solid #b71c1c;
    }

    #your-answer {
      margin-top: 15px;
      font-weight: bold;
      font-size: 1.1em;
      color: #2e7d32;
    }

  </style>
</head>

<body>
  <h1>üèÜ Paris du Jour ‚Äì Handball ‚Ä¢ Biathlon ‚Ä¢ Metroid</h1>

  <div id="instructions">
    <p>Faites vos paris du jour !</p>
    <ul style="text-align:left; display:inline-block;">
      <li>Handball : 6 matchs ‚Üí <b>3 pts / match</b></li>
      <li>Biathlon 20km hommes : <b>15 pts gagnant</b> + <b>10 pts nationalit√©</b></li>
      <li>Note Metacritic Metroid Prime 4 : <b>10 pts (‚Äì1 par √©cart)</b></li>
    </ul>
  </div>

  <div id="userStatus"></div>

  <div id="predictionArea">

    <h3>ü§æ Handball ‚Äì Gagnants</h3>

    <div id="handballMatches"></div>

    <h3>üéø Biathlon ‚Äì Gagnant du 20km hommes</h3>

    <select id="biathlonWinner">
      <option value="">-- Choisissez --</option>
      <option>Uldal</option>
      <option>Frey</option>
      <option>Cristiansen</option>
      <option>Samuelsson</option>
      <option>Nelin</option>
      <option>Perrot</option>
      <option>Jacquelin</option>
      <option>Fillon Maillet</option>
      <option>Autre</option>
    </select>

    <input id="biathlonNation" type="text" placeholder="Nationalit√© du gagnant (ex: Norv√®ge)">

    <h3>üéÆ Metroid Prime 4 ‚Äì Note Metacritic (public)</h3>
    <input id="metroidScore" type="number" min="0" max="100" placeholder="ex : 88">

    <button id="submit-btn">Soumettre mes paris</button>
    <div id="your-answer"></div>
  </div>

  <div id="answersList">
    <h3>üìä Pronostics des autres joueurs :</h3>
    <ul id="answers"></ul>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDlMXjm5ibq9FiPOjrBD1HFAIlYRnCzqA",
  authDomain: "calendrier2025-3185f.firebaseapp.com",
  projectId: "calendrier2025-3185f",
  storageBucket: "calendrier2025-3185f.firebasestorage.app",
  messagingSenderId: "846792576145",
  appId: "1:846792576145:web:59028ccef4ffd5c8010330",
  measurementId: "G-L62L4JSYMF"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const matches = [
  "Danemark - S√©n√©gal",
  "Hongrie - Roumanie",
  "Japon - Suisse",
  "Br√©sil - Cor√©e du Sud",
  "Norv√®ge - Su√®de",
  "Angola - Tch√©quie"
];

const handballDiv = document.getElementById("handballMatches");
matches.forEach((m, i) => {
  handballDiv.innerHTML += `
    <label><b>${m}</b></label><br>
    <select id="hb${i}">
      <option value="">-- Choisissez --</option>
      <option>${m.split(" - ")[0]}</option>
      <option>${m.split(" - ")[1]}</option>
    </select><br><br>
  `;
});

const biathlonWinner = document.getElementById("biathlonWinner");
const biathlonNation = document.getElementById("biathlonNation");
const metroidScore = document.getElementById("metroidScore");

const submitBtn = document.getElementById("submit-btn");
const yourAnswerDiv = document.getElementById("your-answer");
const answersListDiv = document.getElementById("answersList");
const answersList = document.getElementById("answers");

let currentUser = null;

onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    document.getElementById("userStatus").innerText = `Connect√© : ${user.email}`;

    const jourRef = doc(db, "Predictions", "Jour 2");
    const snap = await getDoc(jourRef);

    if (snap.exists() && snap.data()[user.uid]) {
      showExistingPrediction(snap.data()[user.uid]);
    }

  } else {
    window.location.href = "login.html";
  }
});

function showExistingPrediction(data) {
  document.getElementById("predictionArea").style.display = "none";

  yourAnswerDiv.innerHTML = `
    <h3>‚úÖ Vos paris :</h3>
    <ul style="text-align:left;">
      <li><b>Handball :</b> ${JSON.stringify(data.handball).replace(/,/g,", ")}</li>
      <li><b>Biathlon ‚Äì Gagnant :</b> ${data.biathlonWinner}</li>
      <li><b>Nationalit√© :</b> ${data.biathlonNation}</li>
      <li><b>Note Metroid :</b> ${data.metroidScore}</li>
    </ul>
  `;
  answersListDiv.style.display = "block";
  loadOtherAnswers();
}

submitBtn.addEventListener("click", async () => {

  const handball = {};
  for (let i = 0; i < matches.length; i++) {
    const v = document.getElementById("hb" + i).value;
    if (!v) return alert("Merci de compl√©ter tous les paris Handball.");
    handball[matches[i]] = v;
  }

  if (!biathlonWinner.value) return alert("Merci de s√©lectionner le gagnant du Biathlon.");
  if (!biathlonNation.value.trim()) return alert("Merci d'indiquer la nationalit√©.");
  if (!metroidScore.value) return alert("Merci d'indiquer la note Metacritic.");

  const jourRef = doc(db, "Predictions", "Jour 2");
  const snap = await getDoc(jourRef);

  const newPrediction = {
    userId: currentUser.uid,
    UserEmail: currentUser.email,
    handball,
    biathlonWinner: biathlonWinner.value,
    biathlonNation: biathlonNation.value.trim(),
    metroidScore: Number(metroidScore.value),
    timestamp: new Date()
  };

  if (snap.exists()) {
    const data = snap.data();
    if (data[currentUser.uid]) {
      alert("Vous avez d√©j√† soumis vos paris pour aujourd‚Äôhui.");
      return;
    }
    await updateDoc(jourRef, { [currentUser.uid]: newPrediction });
  } else {
    await setDoc(jourRef, { [currentUser.uid]: newPrediction });
  }

  showExistingPrediction(newPrediction);
});

async function loadOtherAnswers() {
  answersList.innerHTML = "";
  const jourRef = doc(db, "Predictions", "Jour 2");
  const snap = await getDoc(jourRef);

  if (!snap.exists()) return;

  const all = snap.data();
  for (const uid in all) {
    if (uid === currentUser.uid) continue;
    const d = all[uid];

    const li = document.createElement("li");
    li.innerHTML = `
      <b>${d.UserEmail}</b> ‚Üí 
      Handball: ${Object.values(d.handball).join(", ")} |
      Biathlon: ${d.biathlonWinner} (${d.biathlonNation}) |
      Metroid: ${d.metroidScore}
    `;
    answersList.appendChild(li);
  }
}

</script>

</body>
</html>
