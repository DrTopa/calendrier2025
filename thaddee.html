<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ Pronos ‚Äì Thadd√©e</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: #fdf6e3;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-size: 2em;
      text-align: center;
      color: #b71c1c;
      margin-bottom: 10px;
      font-family: 'Comic Sans MS', cursive;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }
    #instructions {
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      max-width: 700px;
      margin-bottom: 20px;
      font-size: 1.1em;
      text-align: center;
    }
    #pointsInfo { margin-top: 5px; font-size: 0.9em; color: #444; }
    .question-card {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 20px;
      margin: 10px 0;
      max-width: 700px;
      width: 100%;
      box-shadow: 0px 6px 10px rgba(0,0,0,0.1);
    }
    select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #bbb; font-size: 1em; }
    #submit-btn {
      padding: 12px 25px;
      font-size: 1.2em;
      background-color: #388e3c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
    }
    #submit-btn:hover { background-color: #2e7d32; }
    #your-answer { margin-top: 20px; font-size: 1.1em; font-weight: bold; color: #2e7d32; }
    #answersList {
      display: none;
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0px 5px 10px rgba(0,0,0,0.15);
    }
    #answersList ul { padding-left: 0; }
    #answersList li {
      list-style: none;
      padding: 8px;
      margin: 6px 0;
      background: #fafafa;
      border-left: 5px solid #b71c1c;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<h1>üéØ Pronos ‚Äì Thadd√©e</h1>

<div id="instructions">
  <p>Pariez sur les deux √©v√©nements suivants concernant Thadd√©e :</p>
  <ul style="text-align:left; display:inline-block;">
    <li>Thadd√©e va-t-il gagner de l'argent gr√¢ce √† ses interros ?</li>
    <li>Thadd√©e va-t-il r√©ussir √† r√©pondre √† Ask Us 15 jours de suite sans oublier en D√©cembre ?</li>
  </ul>
  <div id="pointsInfo">üí∞ <b>10 points</b> par bonne r√©ponse</div>
</div>

<div class="question-card">
  <strong>üìå Thadd√©e va-t-il gagner de l'argent gr√¢ce √† ses interros ?</strong><br><br>
  <select id="q1">
    <option value="">-- Choisir --</option>
    <option value="oui">Oui</option>
    <option value="non">Non</option>
  </select>
</div>

<div class="question-card">
  <strong>üìå Thadd√©e va-t-il r√©ussir √† r√©pondre √† Ask Us 15 jours de suite sans oublier en D√©cembre ?</strong><br><br>
  <select id="q2">
    <option value="">-- Choisir --</option>
    <option value="oui">Oui</option>
    <option value="non">Non</option>
  </select>
</div>

<button id="submit-btn">Soumettre mes r√©ponses</button>

<div id="your-answer"></div>

<div id="answersList">
  <h3>üìä R√©ponses des autres joueurs :</h3>
  <ul id="answers"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDlMXjm5ibq9FiPOjrBD1HFAIlYRnCzqA",
  authDomain: "calendrier2025-3185f.firebaseapp.com",
  projectId: "calendrier2025-3185f",
  storageBucket: "calendrier2025-3185f.firebasestorage.app",
  messagingSenderId: "846792576145",
  appId: "1:846792576145:web:59028ccef4ffd5c8010330",
  measurementId: "G-L62L4JSYMF"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
let docRef = null;

// -------------------------------------------------------------
// Auth et cr√©ation imm√©diate de l'entr√©e utilisateur
// -------------------------------------------------------------
onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location.href = "login.html"; return; }
  currentUser = user;

  docRef = doc(db, "Predictions", "Thaddee");
  const snap = await getDoc(docRef);

  if (!snap.exists()) {
    await setDoc(docRef, {}); // Cr√©er le document "Thaddee" si inexistant
  }

  // Cr√©ation du champ utilisateur avec email d√®s l'arriv√©e
  const data = (await getDoc(docRef)).data();
  if (!data[currentUser.uid]) {
    await updateDoc(docRef, {
      [currentUser.uid]: {
        email: currentUser.email,
        createdAt: new Date().toISOString()
      }
    });
  }

  // Si l'utilisateur a d√©j√† r√©pondu ‚Üí afficher
  const updatedData = (await getDoc(docRef)).data();
  if (updatedData[currentUser.uid].q1 && updatedData[currentUser.uid].q2) {
    showUserAnswers(updatedData[currentUser.uid]);
  } else {
    loadOtherAnswers(updatedData);
  }
});

// -------------------------------------------------------------
// Soumission des r√©ponses
// -------------------------------------------------------------
document.getElementById("submit-btn").addEventListener("click", async () => {
  const q1 = document.getElementById("q1").value;
  const q2 = document.getElementById("q2").value;

  if (!q1 || !q2) { alert("Veuillez r√©pondre aux deux questions !"); return; }

  await updateDoc(docRef, {
    [currentUser.uid]: {
      email: currentUser.email,
      createdAt: new Date().toISOString(),
      q1,
      q2,
      submittedAt: new Date().toISOString()
    }
  });

  showUserAnswers({ q1, q2 });
});

// -------------------------------------------------------------
// Affichage des r√©ponses du joueur
// -------------------------------------------------------------
function showUserAnswers(data) {
  document.getElementById("submit-btn").style.display = "none";
  document.getElementById("q1").disabled = true;
  document.getElementById("q2").disabled = true;

  document.getElementById("your-answer").innerHTML =
    "‚úÖ <b>Vos r√©ponses :</b><br>" +
    `Gagner de l'argent gr√¢ce aux interros : <b>${data.q1}</b><br>` +
    `R√©ussir Ask Us 15 jours de suite : <b>${data.q2}</b>`;

  loadOtherAnswers();
}

// -------------------------------------------------------------
// Affichage des r√©ponses des autres joueurs
// -------------------------------------------------------------
async function loadOtherAnswers(existingData = null) {
  const answersUl = document.getElementById("answers");
  const wrapper = document.getElementById("answersList");

  answersUl.innerHTML = "";

  const snap = await getDoc(doc(db, "Predictions", "Thaddee"));
  if (!snap.exists()) return;
  const allData = snap.data();

  Object.entries(allData).forEach(([uid, data]) => {
    if (uid === currentUser.uid) return;
    answersUl.innerHTML += `<li><b>${data.email || 'Anonyme'}</b>` +
      (data.q1 && data.q2 ? ` : Interros: ${data.q1}, Ask Us: ${data.q2}` : " (pas encore r√©pondu)") +
      `</li>`;
  });

  wrapper.style.display = "block";
}
</script>
</body>
</html>
