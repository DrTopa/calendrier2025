<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèÜ Conference League ‚Äì Jour 17</title>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: #fdf6e3;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      font-size: 2em;
      text-align: center;
      color: #b71c1c;
      margin-bottom: 10px;
      font-family: 'Comic Sans MS', cursive;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }

    #instructions {
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      max-width: 900px;
      margin-bottom: 20px;
      font-size: 1.05em;
      text-align: center;
    }

    #pointsInfo {
      font-size: 0.9em;
      color: #555;
      margin-top: 5px;
    }

    #predictionArea {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      max-width: 900px;
      width: 100%;
    }

    .match-card {
      background: rgba(255,255,255,0.95);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 6px 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.2s;
    }

    .match-card:hover {
      transform: translateY(-3px);
    }

    .match-title {
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    }

    select {
      padding: 8px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 90%;
      margin-bottom: 8px;
    }

    #submit-btn {
      padding: 10px 20px;
      font-size: 1.1em;
      cursor: pointer;
      background-color: #388e3c;
      color: white;
      border: none;
      border-radius: 6px;
      margin-top: 20px;
      grid-column: span 2;
    }

    #submit-btn:hover { background-color: #2e7d32; }

    #your-answer {
      margin-top: 15px;
      font-weight: bold;
      font-size: 1.05em;
      color: #2e7d32;
      grid-column: span 2;
    }

    #answersList {
      display: none;
      margin-top: 25px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 4px 6px rgba(0,0,0,0.12);
      max-width: 900px;
      width: 100%;
      grid-column: span 2;
    }

    #answersList li {
      list-style: none;
      background: #fafafa;
      padding: 8px;
      border-radius: 6px;
      margin: 6px 0;
      border-left: 5px solid #b71c1c;
      font-size: 0.95em;
    }
  </style>
</head>

<body>

<h1>üèÜ Conference League ‚Äì Jour 17</h1>

<div id="instructions">
  <p>Choisissez les matchs pour lesquels vous souhaitez parier.</p>
  <div id="pointsInfo">
    Points cumul√©s selon le nombre de bons pronostics ‚Äì une erreur = 0 point.
  </div>
</div>

<div id="predictionArea"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* üî• Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDDlMXjm5ibq9FiPOjrBD1HFAIlYRnCzqA",
  authDomain: "calendrier2025-3185f.firebaseapp.com",
  projectId: "calendrier2025-3185f",
  storageBucket: "calendrier2025-3185f.firebasestorage.app",
  messagingSenderId: "846792576145",
  appId: "1:846792576145:web:59028ccef4ffd5c8010330"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ‚öΩ MATCHS */
const matches = [
  ["AEK Ath√®nes", "Universitatea Craiova"],
  ["AEK Larnaca", "Shk√´ndija"],
  ["AZ Alkmaar", "Jagiellonia Bia≈Çystok"],
  ["Crystal Palace", "KuPS Kuopio"],
  ["Dynamo Kyiv", "FC Noah"],
  ["Lausanne-Sport", "Fiorentina"],
  ["Legia Warszawa", "Lincoln Red Imps"],
  ["Mainz 05", "Samsunspor"],
  ["NK Celje", "Shelbourne"],
  ["Omonia Nicosia", "Rak√≥w Czƒôstochowa"],
  ["Rayo Vallecano", "Drita"],
  ["Shakhtar Donetsk", "Rijeka"],
  ["Shamrock Rovers", "Hamrun Spartans"],
  ["Slovan Bratislava", "H√§cken"],
  ["Sparta Praha", "Aberdeen"],
  ["Strasbourg", "Breidablik"],
  ["Zrinjski Mostar", "Rapid Wien"],
  ["Sigma Olomouc", "Lech Poznan"]
];

const predictionArea = document.getElementById("predictionArea");

/* üß± G√©n√©ration HTML */
matches.forEach(([home, away]) => {
  predictionArea.innerHTML += `
  <div class="match-card">
    <div class="match-title">${home} - ${away}</div>
    <select class="vote-select">
      <option value="">Voter ?</option>
      <option value="oui">Oui</option>
      <option value="non">Non</option>
    </select>
    <select class="match-result" style="display:none;">
      <option value="">R√©sultat</option>
      <option value="equipe1">Victoire ${home}</option>
      <option value="nul">Nul</option>
      <option value="equipe2">Victoire ${away}</option>
    </select>
  </div>`;
});

predictionArea.innerHTML += `
<button id="submit-btn">Soumettre mes paris</button>
<div id="your-answer"></div>
<div id="answersList">
  <h3>üìä Pronostics des autres joueurs :</h3>
  <ul id="answers"></ul>
</div>`;

/* üéØ Logique votes */
const voteSelects = document.querySelectorAll(".vote-select");
const resultSelects = document.querySelectorAll(".match-result");

voteSelects.forEach((vs, i) => {
  vs.addEventListener("change", () => {
    resultSelects[i].style.display = vs.value === "oui" ? "block" : "none";
  });
});

let currentUser = null;

onAuthStateChanged(auth, async user => {
  if (!user) return window.location.href = "login.html";
  currentUser = user;
  const ref = doc(db, "Predictions", "Jour 17");
  const snap = await getDoc(ref);
  if (snap.exists() && snap.data()[user.uid]) {
    showExistingPrediction(snap.data()[user.uid]);
  }
});

/* üíæ Enregistrement */
document.getElementById("submit-btn").addEventListener("click", async () => {
  const predictions = [];
  matches.forEach(([h,a], i) => {
    predictions.push({
      match: `${h} - ${a}`,
      vote: voteSelects[i].value,
      result: resultSelects[i].value
    });
  });

  const payload = {
    userId: currentUser.uid,
    userEmail: currentUser.email,
    predictions,
    timestamp: new Date().toISOString()
  };

  const ref = doc(db, "Predictions", "Jour 17");
  const snap = await getDoc(ref);

  if (snap.exists())
    await updateDoc(ref, { [currentUser.uid]: payload });
  else
    await setDoc(ref, { [currentUser.uid]: payload });

  showExistingPrediction(payload);
});

/* üëÄ Affichage */
function showExistingPrediction(data) {
  document.getElementById("submit-btn").style.display = "none";
  document.getElementById("your-answer").innerHTML =
    "‚úÖ Vos pronostics :<ul>" +
    data.predictions.map(p =>
      `<li>${p.match} : ${p.vote === "oui" ? p.result : "Non vot√©"}</li>`
    ).join("") +
    "</ul>";
}
</script>

</body>
</html>
