<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’« Euromillions â€“ Jour 18 ğŸ’«</title>

<style>
body {
  font-family:'Segoe UI',Tahoma,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  background:#ffebcd url('https://www.transparenttextures.com/patterns/snow.png');
  padding:20px;
  margin:0;
}
h1 {
  font-size:2.2em;
  color:#b71c1c;
  text-align:center;
  font-family:'Comic Sans MS', cursive;
}
#userStatus {
  position:absolute;
  top:10px;
  right:10px;
}
.panel {
  background:rgba(255,255,255,0.95);
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 12px rgba(0,0,0,.2);
  max-width:600px;
  width:100%;
  margin-bottom:20px;
  text-align:center;
}
.row {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
input {
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:1.05em;
  width:100%;
}
button {
  padding:12px 25px;
  font-size:1.1em;
  background:#388e3c;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button:disabled {
  background:#aaa;
  cursor:not-allowed;
}
.choice {
  font-size:1.1em;
  margin:10px 0;
}
#answersList {
  max-width:600px;
  width:100%;
}
#answersList li {
  list-style:none;
  background:#fafafa;
  margin:8px 0;
  padding:10px;
  border-left:5px solid #b71c1c;
  border-radius:6px;
}
</style>
</head>

<body>

<h1>ğŸ’« Euromillions â€“ Jour 18 ğŸ’«</h1>
<div id="userStatus"></div>

<div class="panel" id="form-panel">
  <h2>ğŸŸï¸ Participation</h2>

  <div class="choice">
    <label><input type="radio" name="participation" value="play"> Je participe au tirage</label>
  </div>
  <div class="choice">
    <label><input type="radio" name="participation" value="skip"> Je ne participe pas (+15 jetons)</label>
  </div>

  <div class="panel" id="euro-panel" style="display:none;">
    <h2>ğŸ’« NumÃ©ros Euromillions</h2>

    <div class="row">
      <input id="e1" type="number" min="1" max="50" placeholder="NumÃ©ro 1">
      <input id="e2" type="number" min="1" max="50" placeholder="NumÃ©ro 2">
    </div>
    <div class="row">
      <input id="e3" type="number" min="1" max="50" placeholder="NumÃ©ro 3">
      <input id="e4" type="number" min="1" max="50" placeholder="NumÃ©ro 4">
    </div>
    <input id="e5" type="number" min="1" max="50" placeholder="NumÃ©ro 5">
    <div class="row">
      <input id="s1" type="number" min="1" max="12" placeholder="Ã‰toile 1">
      <input id="s2" type="number" min="1" max="12" placeholder="Ã‰toile 2">
    </div>
  </div>

  <button id="submit-btn">Valider</button>
</div>

<div class="panel" id="your-answer" style="display:none;"></div>

<div id="answersList">
  <h3>ğŸ“Š Choix des joueurs</h3>
  <ul id="answers"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDDlMXjm5ibq9FiPOjrBD1HFAIlYRnCzqA",
  authDomain: "calendrier2025-3185f.firebaseapp.com",
  projectId: "calendrier2025-3185f",
  storageBucket: "calendrier2025-3185f.firebasestorage.app",
  messagingSenderId: "846792576145",
  appId: "1:846792576145:web:59028ccef4ffd5c8010330"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* DOM */
const userStatus = document.getElementById("userStatus");
const euroPanel = document.getElementById("euro-panel");
const submitBtn = document.getElementById("submit-btn");
const formPanel = document.getElementById("form-panel");
const yourAnswer = document.getElementById("your-answer");
const answers = document.getElementById("answers");

let currentUser;

/* Utils */
function validEuro(nums, stars) {
  return new Set(nums).size === 5 &&
         new Set(stars).size === 2 &&
         nums.every(n => n >= 1 && n <= 50) &&
         stars.every(s => s >= 1 && s <= 12);
}

/* Auth */
onAuthStateChanged(auth, async user => {
  if (!user) return location.href = "login.html";
  currentUser = user;
  userStatus.innerText = "ConnectÃ© : " + user.email;
  await loadData();
});

/* Toggle */
document.querySelectorAll("input[name=participation]").forEach(r => {
  r.addEventListener("change", () => {
    euroPanel.style.display = r.value === "play" && r.checked ? "block" : "none";
  });
});

/* Submit */
submitBtn.onclick = async () => {
  const choice = document.querySelector("input[name=participation]:checked");
  if (!choice) return alert("Choisis une option");

  let data = {
    email: currentUser.email,
    participation: choice.value,
    timestamp: new Date().toISOString()
  };

  if (choice.value === "play") {
    const nums = [e1,e2,e3,e4,e5].map(i => Number(i.value));
    const stars = [s1,s2].map(i => Number(i.value));
    if (!validEuro(nums, stars)) return alert("NumÃ©ros invalides");
    data.euroNums = nums;
    data.euroStars = stars;
  } else {
    data.jetons = 15;
  }

  await setDoc(doc(db,"Predictions","Jour 18"), {
    [currentUser.uid]: data
  }, { merge:true });

  await loadData();
};

/* Load + lock */
async function loadData() {
  const ref = doc(db,"Predictions","Jour 18");
  const snap = await getDoc(ref);
  if (!snap.exists()) return;

  const data = snap.data();

  answers.innerHTML = "";

  Object.entries(data).forEach(([uid,d])=>{
    const li = document.createElement("li");
    li.innerHTML =
      `<b>${d.email}</b><br>` +
      (d.participation==="play"
        ? `ğŸ’« ${d.euroNums.join(", ")} â­ ${d.euroStars.join(", ")}`
        : `ğŸ Ne participe pas (+15 jetons)`);
    answers.appendChild(li);

    if (uid === currentUser.uid) {
      formPanel.style.display = "none";
      yourAnswer.style.display = "block";
      yourAnswer.innerHTML = li.innerHTML;
    }
  });
}
</script>

</body>
</html>
