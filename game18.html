<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’« Euromillions â€“ Jour 18 ğŸ’«</title>

<style>
body {
  font-family: 'Segoe UI', Tahoma, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  background:#ffebcd url('https://www.transparenttextures.com/patterns/snow.png');
  padding:20px;
  margin:0;
}
h1 {
  font-size:2.2em;
  color:#b71c1c;
  text-align:center;
  font-family:'Comic Sans MS', cursive;
}
#userStatus {
  position:absolute;
  top:10px;
  right:10px;
}
.panel {
  background:rgba(255,255,255,0.95);
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 12px rgba(0,0,0,.2);
  max-width:600px;
  width:100%;
  margin-bottom:20px;
  text-align:center;
}
.row {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
input {
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:1.05em;
  width:100%;
}
button {
  padding:12px 25px;
  font-size:1.1em;
  background:#388e3c;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button:hover {
  background:#2e7d32;
}
#answersList {
  display:none;
  max-width:600px;
  width:100%;
}
#answersList li {
  list-style:none;
  background:#fafafa;
  margin:8px 0;
  padding:10px;
  border-left:5px solid #b71c1c;
  border-radius:6px;
}
.choice {
  font-size:1.1em;
  margin:10px 0;
}
</style>
</head>

<body>

<h1>ğŸ’« Euromillions â€“ Jour 18 ğŸ’«</h1>
<div id="userStatus"></div>

<div class="panel">
  <h2>ğŸŸï¸ Participation</h2>

  <div class="choice">
    <label>
      <input type="radio" name="participation" value="play">
      Je participe au tirage
    </label>
  </div>

  <div class="choice">
    <label>
      <input type="radio" name="participation" value="skip">
      Je ne participe pas (+15 jetons)
    </label>
  </div>
</div>

<div class="panel" id="euro-panel" style="display:none;">
  <h2>ğŸ’« NumÃ©ros Euromillions</h2>

  <div class="row">
    <input id="e1" type="number" min="1" max="50" placeholder="NumÃ©ro 1">
    <input id="e2" type="number" min="1" max="50" placeholder="NumÃ©ro 2">
  </div>

  <div class="row">
    <input id="e3" type="number" min="1" max="50" placeholder="NumÃ©ro 3">
    <input id="e4" type="number" min="1" max="50" placeholder="NumÃ©ro 4">
  </div>

  <input id="e5" type="number" min="1" max="50" placeholder="NumÃ©ro 5">

  <div class="row">
    <input id="s1" type="number" min="1" max="12" placeholder="Ã‰toile 1">
    <input id="s2" type="number" min="1" max="12" placeholder="Ã‰toile 2">
  </div>
</div>

<button id="submit-btn">Valider</button>
<div id="your-answer"></div>

<div id="answersList">
  <h3>ğŸ“Š Choix des autres joueurs</h3>
  <ul id="answers"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDDlMXjm5ibq9FiPOjrBD1HFAIlYRnCzqA",
  authDomain: "calendrier2025-3185f.firebaseapp.com",
  projectId: "calendrier2025-3185f",
  storageBucket: "calendrier2025-3185f.firebasestorage.app",
  messagingSenderId: "846792576145",
  appId: "1:846792576145:web:59028ccef4ffd5c8010330"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* DOM */
const userStatus = document.getElementById("userStatus");
const euroPanel = document.getElementById("euro-panel");
const submitBtn = document.getElementById("submit-btn");
const yourAnswer = document.getElementById("your-answer");
const answers = document.getElementById("answers");
const answersList = document.getElementById("answersList");

const e1 = document.getElementById("e1");
const e2 = document.getElementById("e2");
const e3 = document.getElementById("e3");
const e4 = document.getElementById("e4");
const e5 = document.getElementById("e5");
const s1 = document.getElementById("s1");
const s2 = document.getElementById("s2");

let currentUser = null;

/* Auth */
onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }
  currentUser = user;
  userStatus.innerText = "ConnectÃ© : " + user.email;
  loadOthers();
});

/* Participation toggle */
document.querySelectorAll("input[name=participation]").forEach(radio => {
  radio.addEventListener("change", () => {
    euroPanel.style.display =
      radio.value === "play" && radio.checked ? "block" : "none";
  });
});

/* Validation */
function validEuro(nums, stars) {
  return new Set(nums).size === 5 &&
         new Set(stars).size === 2 &&
         nums.every(n => n >= 1 && n <= 50) &&
         stars.every(s => s >= 1 && s <= 12);
}

/* Submit */
submitBtn.addEventListener("click", async () => {
  const choice = document.querySelector("input[name=participation]:checked");
  if (!choice) return alert("Choisis une option");

  let data = {
    email: currentUser.email,
    participation: choice.value,
    timestamp: new Date().toISOString()
  };

  if (choice.value === "play") {
    const nums = [
      Number(e1.value),
      Number(e2.value),
      Number(e3.value),
      Number(e4.value),
      Number(e5.value)
    ];
    const stars = [
      Number(s1.value),
      Number(s2.value)
    ];

    if (!validEuro(nums, stars)) {
      return alert("NumÃ©ros Euromillions invalides");
    }

    data.euroNums = nums;
    data.euroStars = stars;
  } else {
    data.jetons = 15;
  }

  const ref = doc(db, "Predictions", "Jour 18");
  const snap = await getDoc(ref);

  if (snap.exists()) {
    await updateDoc(ref, { [currentUser.uid]: data });
  } else {
    await setDoc(ref, { [currentUser.uid]: data });
  }

  yourAnswer.innerHTML = "âœ… Choix enregistrÃ©";
  loadOthers();
});

/* Load others */
async function loadOthers() {
  const ref = doc(db, "Predictions", "Jour 18");
  const snap = await getDoc(ref);
  if (!snap.exists()) return;

  answers.innerHTML = "";

  Object.entries(snap.data()).forEach(([uid, d]) => {
    if (uid === currentUser.uid) return;

    const li = document.createElement("li");
    li.innerHTML =
      `<b>${d.email}</b><br>` +
      (d.participation === "play"
        ? `ğŸ’« ${d.euroNums.join(", ")} â­ ${d.euroStars.join(", ")}`
        : `ğŸ Ne participe pas (+15 jetons)`);

    answers.appendChild(li);
  });

  answersList.style.display = "block";
}
</script>


</body>
</html>
